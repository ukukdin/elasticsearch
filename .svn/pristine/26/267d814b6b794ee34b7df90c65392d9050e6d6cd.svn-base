<?xml version="1.0" encoding= "UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
 
<mapper namespace="nurier.scraping.setting.dao.SettingRuleDataManageSqlMapper">
    
    <select id="getAgentVersionList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT SEQ_NUM,
   			   AVDEVICE,
	  		   AVCODE,
   			   TO_CHAR(RGDATE, 'YYYY-MM-DD HH24:MI:SS') RGDATE,
   			   RGNAME,
   			   TO_CHAR(MODDATE, 'YYYY-MM-DD HH24:MI:SS') MODDATE,
   			   MODNAME,
	  		   IS_USED,
   			   AVDELETE
        FROM NFDS_AGENT_VERSION
        WHERE AVDEVICE = #{avdevice}
        AND AVDELETE = 'N'
        ORDER BY SEQ_NUM DESC
    </select>
    
    <insert id="setAgentVersion" parameterType="java.util.HashMap">
    	<selectKey resultType="String" keyProperty="seq_num" order="BEFORE">
            SELECT NVL(MAX(SEQ_NUM),0)+1 as seq_num FROM NFDS_AGENT_VERSION
        </selectKey>
    	INSERT INTO NFDS_AGENT_VERSION(
    		SEQ_NUM,
   			AVDEVICE,
	  		AVCODE,
   			RGDATE,
   			RGNAME,
   			MODDATE,
   			MODNAME,
	  		IS_USED,
   			AVDELETE
    	)
    	VALUES(
    		#{seq_num},
   			#{avdevice},
	  		#{avcode},
   			SYSDATE,
   			#{rgname},
   			SYSDATE,
   			#{modname},
	  		#{is_used},
   			#{avdelete}
   		)
    </insert>
    
    <update id="setAgentVersionUpdate" parameterType="java.util.HashMap">
        UPDATE NFDS_AGENT_VERSION SET
        MODDATE	= SYSDATE,
        MODNAME = #{modname},
        IS_USED = #{is_used},
        AVDELETE = #{avdelete}
        WHERE SEQ_NUM = #{seq_num}
    </update>
    
    
    <select id="getNumAgentVersionList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT SEQ_NUM,
   			   AVDEVICE,
	  		   AVCODE,
   			   TO_CHAR(RGDATE, 'YYYY-MM-DD HH24:MI:SS') RGDATE,
   			   RGNAME,
   			   TO_CHAR(MODDATE, 'YYYY-MM-DD HH24:MI:SS') MODDATE,
   			   MODNAME,
	  		   IS_USED,
   			   AVDELETE
        FROM NFDS_AGENT_VERSION
        WHERE SEQ_NUM = #{seq_num}
    </select>
    
</mapper>
